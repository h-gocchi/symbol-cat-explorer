import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

// --- Ë®≠ÂÆö ---
const STABLE_NODES = [
    "https://symbol-sakura-16.next-web-technology.com:3001",
    "https://symbol.ea-node.com:3001",
    "https://xym-test.all-nodes.com:3001",
    "https://node.xym.jp:3001",
    "https://dual-1.nodes-xym.work:3001"
];

// Gemini API Ë®≠ÂÆö
const apiKey = ""; 
const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";

// --- „Éò„É´„Éë„ÉºÈñ¢Êï∞: „Éã„É£„É™„Éº„É≥Èü≥ ---
const playNyareen = () => {
    try {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(950, audioCtx.currentTime); 
        oscillator.frequency.exponentialRampToValueAtTime(1900, audioCtx.currentTime + 0.1);
        oscillator.frequency.exponentialRampToValueAtTime(1500, audioCtx.currentTime + 0.3);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.5);
    } catch (e) { console.log("Audio blocked"); }
};

// --- „Ç¢„Ç§„Ç≥„É≥ ---
const Icon = ({ name, size = 24, className = "" }) => {
    const icons = {
        Database: <path d="M3 5V19C3 20.66 7.03 22 12 22C16.97 22 21 20.66 21 19V5M3 5C3 6.66 7.03 8 12 8C16.97 8 21 6.66 21 5M3 5C3 3.34 7.03 2 12 2C16.97 2 21 3.34 21 5M3 12C3 13.66 7.03 15 12 15C16.97 15 21 13.66 21 12" />,
        RefreshCw: <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16M3 21v-5h5" />,
        Hash: <path d="M4 9h16M4 15h16M10 3L8 21M16 3l-2 18" />,
        Box: <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z M3.27 6.96L12 12.01l8.73-5.05M12 22.08V12" />,
        Send: <path d="m22 2-7 20-4-9-9-4Z M22 2 11 13" />,
        ArrowLeft: <g><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></g>,
        Fish: <g><path d="M2 12c.6.6 2.25 2 3.5 2 1.3 0 1.9-1.4 3.5-1.4s2.2 1.4 3.5 1.4 2.9-1.4 3.5-1.4 1.3.4 2 1c.7.6 1.3 1 2.5 1 1.2 0 2.4-.4 3.5-1L22 12l-1.5-1.5c-1.1-.6-2.3-1-3.5-1-1.2 0-1.8.4-2.5 1-.7.6-1.4 1-2 1s-2.2-1.4-3.5-1.4-2.2 1.4-3.5 1.4-2.2-1.4-3.5-1.4C3.25 10 2.6 11.4 2 12Z" /><path d="M22 12c-3 0-6-4-6-4s-3 4-6 4" /></g>,
        Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
    };
    return (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}>
            {icons[name] || <circle cx="12" cy="12" r="10" />}
        </svg>
    );
};

// --- Áå´ SVG ---
const DeformedCat = ({ color = "#ff4500", type = "face", className = "", expression = "normal" }) => {
    const strokeColor = "#3d1106"; 
    const Eyes = () => {
        switch(expression) {
            case 'joy': return <g><path d="M30,35 Q35,30 40,35" fill="none" stroke="black" strokeWidth="3" /><path d="M60,35 Q65,30 70,35" fill="none" stroke="black" strokeWidth="3" /></g>;
            case 'wow': return <g><circle cx="35" cy="38" r="5" fill="black" stroke="none" /><circle cx="65" cy="38" r="5" fill="black" stroke="none" /></g>;
            case 'wink': return <g><path d="M30,38 Q35,35 40,38" fill="none" stroke="black" strokeWidth="3" /><circle cx="65" cy="38" r="3" fill="black" stroke="none" /></g>;
            case 'love': return <g><text x="26" y="45" style={{fontSize: '22px'}}>‚ù§Ô∏è</text><text x="56" y="45" style={{fontSize: '22px'}}>‚ù§Ô∏è</text></g>;
            default: return <g><circle cx="35" cy="40" r="3" fill="black" stroke="none" /><circle cx="65" cy="40" r="3" fill="black" stroke="none" /></g>;
        }
    };
    const Mouth = () => {
        switch(expression) {
            case 'joy': return <path d="M42,52 Q50,60 58,52" fill="none" stroke="black" strokeWidth="3" />;
            case 'wow': return <circle cx="50" cy="55" r="5" fill="none" stroke="black" strokeWidth="3" />;
            default: return <path d="M45,50 Q50,55 55,50" fill="none" stroke="black" strokeWidth="3" />;
        }
    };

    if (type === "face") {
        return (
            <svg viewBox="0 0 100 100" className={className} fill={color} stroke={strokeColor} strokeWidth="3">
                <path d="M25,25 L15,5 L35,15 Z" /><path d="M75,25 L85,5 L65,15 Z" />
                <path d="M20,40 Q20,20 40,20 T60,20 T80,40 Q80,70 50,70 T20,40" />
                <Eyes /><Mouth />
            </svg>
        );
    }
    return (
        <svg viewBox="0 0 100 100" className={className} fill={color} stroke={strokeColor} strokeWidth="3">
            <rect x="25" y="40" width="50" height="35" rx="15" />
            <path d="M30,40 Q30,25 50,25 T70,40" />
            <path d="M35,28 L30,10 L45,25 Z" /><path d="M65,28 L70,10 L55,25 Z" />
            <motion.path animate={{ rotate: [-15, 15, -15] }} transition={{ repeat: Infinity, duration: 0.8 }} d="M75,55 Q90,45 85,30" fill="none" stroke={color} strokeWidth="6" strokeLinecap="round" />
            <circle cx="42" cy="38" r="2" fill="black" stroke="none" /><circle cx="58" cy="38" r="2" fill="black" stroke="none" />
            <motion.circle animate={{ x: [-3, 3, -3], y: [0, -4, 0] }} transition={{ repeat: Infinity, duration: 0.35 }} cx="35" cy="75" r="6" fill={strokeColor} stroke="none" />
            <motion.circle animate={{ x: [3, -3, 3], y: [0, -4, 0] }} transition={{ repeat: Infinity, duration: 0.35 }} cx="65" cy="75" r="6" fill={strokeColor} stroke="none" />
        </svg>
    );
};

// --- „Çµ„Éñ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---
const DetailRow = ({ label, value, isMono = false, isLink = false, onClick = null }) => (
    <div className="border-b border-orange-100 pb-5">
        <p className="text-[10px] font-black uppercase text-slate-400 tracking-widest leading-none mb-2">{label}</p>
        <p onClick={onClick} className={`text-base font-bold break-all ${isMono ? 'font-mono text-[13px]' : ''} ${isLink ? 'text-orange-600 cursor-pointer hover:underline' : 'text-slate-700'}`}>{value}</p>
    </div>
);

const StatCard = ({ icon, title, value, color }) => (
    <div className="bg-white p-7 rounded-[3.5rem] shadow-xl border-4 border-orange-100 flex items-center gap-5 relative overflow-hidden group">
        <div className={`p-4 bg-slate-50 rounded-2xl ${color} shadow-inner`}><Icon name={icon} size={24} /></div>
        <div><p className="text-[11px] font-black uppercase opacity-60 tracking-widest leading-none">{title}</p><p className="text-3xl font-black mt-2 leading-none text-slate-800">{value}</p></div>
        <div className="absolute -bottom-6 -right-6 w-28 h-28 opacity-[0.12] group-hover:scale-110 transition-transform duration-500"><DeformedCat type="face" /></div>
    </div>
);

export default function App() {
    const [nodeIndex, setNodeIndex] = useState(0);
    const [blocks, setBlocks] = useState([]);
    const [transactions, setTransactions] = useState([]);
    const [latestHeight, setLatestHeight] = useState(0);
    const [isLoading, setIsLoading] = useState(true);
    const [catEvents, setCatEvents] = useState([]);
    const [notifications, setNotifications] = useState([]);
    const [selectedItem, setSelectedItem] = useState(null);
    const [isDetailLoading, setIsDetailLoading] = useState(false);
    const [showBigBanner, setShowBigBanner] = useState(null);
    const [logoExpression, setLogoExpression] = useState('normal');

    const nodeUrl = STABLE_NODES[nodeIndex];

    // --- AI Áå´Ë™ûÁîüÊàê API (Exponential Backoff ‰ªò„Åç) ---
    const generateCatComment = async (txData) => {
        const systemPrompt = "„ÅÇ„Å™„Åü„ÅØSymbol„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥„ÇíÊ°àÂÜÖ„Åô„ÇãË≥¢„Åè„Å¶ÂèØÊÑõ„ÅÑÁå´„Åß„Åô„ÄÇ„Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÇíË¶ã„Å¶„ÄÅ20ÊñáÂ≠ó‰ª•ÂÜÖ„ÅÆÁü≠„ÅÑÁå´Ë™ûÔºàË™ûÂ∞æ„Å´„Éã„É£„ÄÅ„Ç¥„É≠„Ç¥„É≠Á≠âÔºâ„Åß‰∏ÄË®Ä„Ç≥„É°„É≥„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰æãÔºöÈÄÅÈáë„Éã„É£ÔºÅÁæéÂë≥„Åó„ÅÑÈ≠ö„ÇíË≤∑„Å£„Åü„ÅÆ„Åã„Éã„É£Ôºü";
        const userPrompt = `Type: ${txData.transaction.type}, Hash: ${txData.meta.hash}`;

        const fetchWithRetry = async (retryCount = 0) => {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Êñ∞„Åó„ÅÑTX„Éã„É£ÔºÅüêæ";
            } catch (err) {
                if (retryCount < 5) {
                    const delay = Math.pow(2, retryCount) * 1000;
                    await new Promise(res => setTimeout(res, delay));
                    return fetchWithRetry(retryCount + 1);
                }
                return "‰Ωï„Åã„ÅåÂãï„ÅÑ„Åü„Éã„É£...üêæ";
            }
        };
        return await fetchWithRetry();
    };

    // „É≠„Ç¥Ë°®ÊÉÖÂàá„ÇäÊõø„Åà„Çø„Ç§„Éû„Éº
    useEffect(() => {
        const expressions = ['normal', 'joy', 'wow', 'wink', 'love'];
        const interval = setInterval(() => {
            setLogoExpression(expressions[Math.floor(Math.random() * expressions.length)]);
        }, 5000);
        return () => clearInterval(interval);
    }, []);

    const triggerCat = async (type, detail = "", txData = null) => {
        const id = Math.random().toString(36).substr(2, 9);
        const yPos = Math.random() * 30 + 35;
        let aiComment = "";
        
        if (type === 'tx' && txData) {
            aiComment = await generateCatComment(txData);
        }

        setCatEvents(prev => [...prev, { id, type, detail, yPos, aiComment, catType: type === 'block' ? 'full' : 'face' }]);
        setTimeout(() => setCatEvents(prev => prev.filter(c => c.id !== id)), 15500);
    };

    const syncBlockchain = useCallback(async () => {
        try {
            const res = await fetch(`${nodeUrl}/chain/info`);
            const chainInfo = await res.json();
            const currentHeight = parseInt(chainInfo.height);

            if (latestHeight !== 0 && currentHeight > latestHeight) {
                playNyareen();
                setShowBigBanner(currentHeight);
                setLogoExpression('wow');
                setTimeout(() => setShowBigBanner(null), 7000);
                triggerCat('block', `#${currentHeight}`);
            }
            setLatestHeight(currentHeight);

            const blocksRes = await fetch(`${nodeUrl}/blocks?limit=10&order=desc`);
            const blocksData = await blocksRes.json();
            setBlocks(blocksData.data || []);

            const txRes = await fetch(`${nodeUrl}/transactions/confirmed?pageSize=10&order=desc`);
            const txData = await txRes.json();
            const newTxs = txData.data || [];

            if (transactions.length > 0 && newTxs.length > 0 && newTxs[0].meta.hash !== transactions[0].meta.hash) {
                triggerCat('tx', "Transaction", newTxs[0]);
                setLogoExpression('wink');
            }
            setTransactions(newTxs);
            setIsLoading(false);
        } catch (err) {
            setNodeIndex((prev) => (prev + 1) % STABLE_NODES.length);
        }
    }, [nodeUrl, latestHeight, transactions]);

    useEffect(() => {
        syncBlockchain();
        const interval = setInterval(syncBlockchain, 15000);
        return () => clearInterval(interval);
    }, [syncBlockchain]);

    const viewDetail = async (type, id) => {
        setSelectedItem({ type, id, data: null });
        setIsDetailLoading(true);
        setLogoExpression('love');
        try {
            let data = null;
            if (type === 'block') {
                const res = await fetch(`${nodeUrl}/blocks/${id}`);
                data = await res.json();
            } else if (type === 'tx') {
                const res = await fetch(`${nodeUrl}/transactions/confirmed/${id}`);
                data = await res.json();
            } else if (type === 'account') {
                const res = await fetch(`${nodeUrl}/accounts/${id}`);
                data = await res.json();
                const mRes = await fetch(`${nodeUrl}/accounts/${id}/mosaics`);
                data.mosaics = await mRes.json();
            }
            setSelectedItem({ type, id, data });
        } catch (e) { 
            console.error(e); 
        } finally { 
            setIsDetailLoading(false); 
        }
    };

    return (
        <div className="min-h-screen bg-[#fffaf2] text-slate-700 pb-12 overflow-x-hidden relative">
            <header className="bg-white/90 backdrop-blur-md border-b-8 border-orange-100 sticky top-0 z-50 px-6 py-4 shadow-sm flex items-center justify-between">
                <div className="flex items-center gap-4 cursor-pointer" onClick={() => setSelectedItem(null)}>
                    <motion.div animate={{ rotate: [0, -10, 10, 0], scale: [1, 1.1, 1] }} transition={{ repeat: Infinity, duration: 5 }} className="bg-orange-600 p-2 rounded-2xl text-white shadow-lg shadow-orange-200">
                        <DeformedCat type="face" color="white" expression={logoExpression} className="w-10 h-10 transition-all duration-300" />
                    </motion.div>
                    <h1 className="text-xl md:text-2xl font-black text-orange-600 uppercase italic tracking-tighter leading-none">Neko Explorer</h1>
                </div>
                <button onClick={syncBlockchain} className="bg-orange-500 text-white p-3 rounded-2xl shadow-md hover:bg-orange-600 active:scale-95 transition-all"><Icon name="RefreshCw" size={20} className={isLoading ? "animate-spin" : ""} /></button>
            </header>

            <main className="max-w-6xl mx-auto px-6 py-8">
                {!selectedItem ? (
                    <>
                        <div className="relative h-[28rem] w-full mb-10 overflow-hidden rounded-[4rem] bg-white border-8 border-orange-100/50 shadow-inner">
                            <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10 text-center">
                                <div className="text-9xl mb-2 text-orange-300">üêæ</div>
                                <p className="font-black text-orange-500 tracking-[0.5em] text-xl">Neko Playground</p>
                            </div>

                            <AnimatePresence>
                                {showBigBanner && (
                                    <motion.div initial={{ y: -150, opacity: 0 }} animate={{ y: 40, opacity: 1 }} exit={{ y: -150, opacity: 0 }}
                                        className="absolute top-0 left-0 right-0 z-[40] flex justify-center pointer-events-none px-4">
                                        <div className="bg-[#ff4500] text-white px-8 md:px-16 py-8 rounded-[3.5rem] shadow-[0_30px_70px_rgba(255,69,0,0.6)] border-4 border-white text-center">
                                            <p className="text-sm font-black uppercase tracking-[0.4em] mb-2">üéâ MEOW BLOCK NEWS! üéâ</p>
                                            <p className="text-4xl font-black leading-tight">Êñ∞„Éñ„É≠„ÉÉ„ÇØ #{showBigBanner}<br/>Âà∞ÁùÄ„Åó„Åü„Éã„É£ÔºÅ</p>
                                        </div>
                                    </motion.div>
                                )}
                            </AnimatePresence>

                            <AnimatePresence>
                                {catEvents.map((cat) => (
                                    <motion.div key={cat.id} initial={{ x: "-350px", y: cat.yPos + "%", opacity: 1 }} animate={{ x: "120vw", opacity: 1 }} transition={{ duration: 15, ease: "linear" }} className="absolute z-20 pointer-events-none">
                                        <motion.div animate={{ y: [0, -30, 0] }} transition={{ repeat: Infinity, duration: 0.6, ease: "easeInOut" }} className="relative text-center">
                                            {cat.aiComment && (
                                                <div className="absolute -top-24 left-1/2 -translate-x-1/2 bg-white px-4 py-3 rounded-2xl shadow-xl border-4 border-orange-200 text-[11px] font-black min-w-[150px] after:content-[''] after:absolute after:top-full after:left-1/2 after:-translate-x-1/2 after:border-[12px] after:border-transparent after:border-t-orange-200">
                                                    {cat.aiComment}
                                                </div>
                                            )}
                                            <div className="bg-[#3d1106] text-white px-5 py-2 rounded-full shadow-2xl border-4 border-white text-[13px] font-black mb-3 inline-block whitespace-nowrap">
                                                {cat.type === 'block' ? 'üì¶ BLOCK!' : '‚ú® TX!'}
                                            </div>
                                            <DeformedCat type={cat.catType} color={cat.type === 'block' ? '#ff4500' : '#ffa500'} className="w-44 h-44 filter drop-shadow-[0_25px_30px_rgba(0,0,0,0.3)]" />
                                            <div className="absolute -bottom-6 -right-12 text-7xl">{cat.type === 'block' ? 'üéÅ' : 'üêü'}</div>
                                        </motion.div>
                                    </motion.div>
                                ))}
                            </AnimatePresence>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                            <StatCard icon="Hash" title="Height" value={latestHeight || "..."} color="text-orange-600" />
                            <StatCard icon="Box" title="Blocks" value={blocks.length} color="text-pink-600" />
                            <StatCard icon="Send" title="TXs" value={transactions.length} color="text-blue-600" />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                            <section className="bg-white rounded-[3rem] p-8 shadow-xl border-t-8 border-orange-200">
                                <h2 className="text-xl font-black flex items-center gap-3 mb-8 text-orange-600"><Icon name="Box" /> Recent Blocks</h2>
                                <div className="space-y-4">
                                    {blocks.map((b) => (
                                        <div key={b.meta.hash} onClick={() => viewDetail('block', b.block.height)} className="group cursor-pointer bg-orange-50/50 p-5 rounded-[2.5rem] flex items-center justify-between border-2 border-transparent hover:border-orange-200 hover:bg-white transition-all shadow-sm">
                                            <div className="flex items-center gap-4">
                                                <div className="relative w-14 h-14 bg-white rounded-2xl flex items-center justify-center border border-orange-100 shadow-inner group-hover:rotate-12 transition-transform"><div className="absolute -top-3 -left-3 text-2xl">üê±</div><span className="font-black text-orange-600 text-sm">#{b.block.height.toString().slice(-3)}</span></div>
                                                <div><div className="text-sm font-black mb-1 tracking-tight leading-none">Height: {b.block.height}</div><div className="text-[10px] text-orange-500 font-bold bg-orange-100/50 px-2 py-0.5 rounded-full">Neko Verified üêæ</div></div>
                                            </div>
                                            <div className="bg-orange-600 text-white text-[10px] font-black px-4 py-1.5 rounded-full shadow-sm">{b.block.transactionsCount} TXs üêü</div>
                                        </div>
                                    ))}
                                </div>
                            </section>
                            <section className="bg-white rounded-[3rem] p-8 shadow-xl border-t-8 border-blue-200">
                                <h2 className="text-xl font-black flex items-center gap-3 mb-8 text-blue-600"><Icon name="Send" /> Recent TXs</h2>
                                <div className="space-y-4">
                                    {transactions.map((t) => (
                                        <div key={t.meta.hash} onClick={() => viewDetail('tx', t.meta.hash)} className="cursor-pointer bg-blue-50/50 p-5 rounded-[2.5rem] flex items-center justify-between border-2 border-transparent hover:border-blue-100 hover:bg-white transition-all shadow-sm">
                                            <div className="flex items-center gap-4 min-w-0">
                                                <div className="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-2xl border border-blue-50 shadow-inner">üêü</div>
                                                <div className="min-w-0"><div className="text-sm font-black text-blue-600 truncate max-w-[120px]">Type: {t.transaction.type}</div><div className="text-[9px] text-slate-400 font-mono truncate">{t.meta.hash}</div></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </section>
                        </div>
                    </>
                ) : (
                    <div className="max-w-4xl mx-auto">
                        <button onClick={() => setSelectedItem(null)} className="mb-6 flex items-center gap-2 text-orange-600 font-bold hover:translate-x-[-4px] transition-transform"><Icon name="ArrowLeft" size={20} /> Playground„Å´Êàª„Çã</button>
                        {isDetailLoading ? (
                            <div className="text-center py-20">
                                <motion.div animate={{ rotate: 360 }} transition={{ repeat: Infinity, duration: 1 }} className="inline-block mb-4"><DeformedCat type="face" className="w-24 h-24" expression="wow" /></motion.div>
                                <p className="font-black text-orange-500 animate-pulse">Áå´„Åå„Éá„Éº„Çø„Çí‰∏ÄÁîüÊá∏ÂëΩÊéò„ÇäÂá∫„Åó„Å¶„Çã„Éã„É£...</p>
                            </div>
                        ) : (
                            <motion.div initial={{ y: 20, opacity: 1 }} animate={{ y: 0, opacity: 1 }} className="relative bg-white rounded-[3.5rem] p-10 shadow-2xl detail-card border-4 border-orange-100">
                                <div className="flex justify-between items-start mb-8">
                                    <div><span className="bg-orange-100 text-orange-600 text-[11px] font-black px-3 py-1 rounded-full uppercase tracking-widest">{selectedItem.type} Details</span><h2 className="text-2xl md:text-3xl font-black text-slate-800 mt-2 break-all leading-tight">{selectedItem.id}</h2></div>
                                    <DeformedCat type="face" className="w-20 h-20 opacity-30" expression="love" />
                                </div>
                                <div className="space-y-6">
                                    {selectedItem.type === 'block' && selectedItem.data && (
                                        <>
                                            <DetailRow label="„Éè„ÉÉ„Ç∑„É•" value={selectedItem.data.meta.hash} isMono />
                                            <DetailRow label="ÁîüÊàê„Åó„ÅüÁå´ (Harvester)" value={selectedItem.data.block.signerPublicKey} isMono isLink onClick={() => viewDetail('account', selectedItem.data.block.signerPublicKey)} />
                                            <DetailRow label="„Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥Êï∞" value={selectedItem.data.block.transactionsCount} />
                                            <DetailRow label="ÊôÇÂàª" value={new Date(parseInt(selectedItem.data.block.timestamp) + 1615853185000).toLocaleString()} />
                                        </>
                                    )}
                                    {selectedItem.type === 'tx' && selectedItem.data && (
                                        <>
                                            <DetailRow label="ÈÄÅ‰ø°ÂÖÉÁå´" value={selectedItem.data.transaction.signerPublicKey} isMono isLink onClick={() => viewDetail('account', selectedItem.data.transaction.signerPublicKey)} />
                                            <DetailRow label="„Çø„Ç§„Éó" value={selectedItem.data.transaction.type} />
                                            <DetailRow label="ÊâãÊï∞Êñô" value={`${selectedItem.data.transaction.maxFee / 1000000} XYM`} />
                                            <DetailRow label="ÊâøË™çÊôÇ„ÅÆÈ´ò„Åï" value={selectedItem.data.meta.height} isLink onClick={() => viewDetail('block', selectedItem.data.meta.height)} />
                                        </>
                                    )}
                                    {selectedItem.type === 'account' && selectedItem.data && (
                                        <>
                                            <div className="bg-orange-50 rounded-[2rem] p-8 mb-6 flex items-center justify-between border-2 border-orange-100 shadow-inner">
                                                <div><p className="text-[11px] font-black uppercase text-orange-500">Neko Balance</p><p className="text-4xl font-black text-orange-600 mt-1">XYM „ÅäË≤°Â∏É</p></div>
                                                <div className="text-right"><Icon name="Fish" size={60} className="text-orange-400 opacity-60 ml-auto" /></div>
                                            </div>
                                            <h3 className="font-black text-xl text-slate-700 flex items-center gap-2 mb-4"><Icon name="Fish" className="text-orange-500" /> ÊåÅ„Å£„Å¶„ÅÑ„Çã„ÅäÈ≠ö (Mosaics)</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {selectedItem.data.mosaics?.map((m, idx) => (
                                                    <div key={idx} className="bg-slate-50 p-5 rounded-3xl border-2 border-transparent hover:border-orange-200 transition-all shadow-sm">
                                                        <p className="text-[10px] font-mono text-slate-400">Mosaic ID: {m.id}</p>
                                                        <p className="text-xl font-black text-slate-800 mt-1">{m.amount / 1000000} <span className="text-xs opacity-50 tracking-tighter">Units</span></p>
                                                    </div>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </motion.div>
                        )}
                    </div>
                )}
            </main>
            
            <div className="fixed bottom-8 left-8 z-[100] flex flex-col gap-3 pointer-events-none">
                <AnimatePresence>
                    {notifications.map((n) => (
                        <motion.div key={n.id} initial={{ x: -100, opacity: 1 }} animate={{ x: 0, opacity: 1 }} exit={{ x: -100, opacity: 0 }} 
                            className="bg-white p-5 rounded-[2.5rem] shadow-2xl flex items-center gap-4 border-4 border-orange-200 pointer-events-auto shadow-orange-100/50">
                            <DeformedCat type="face" className="w-14 h-14" expression="joy" /><div className="text-sm font-black text-slate-800 pr-4">{n.message}</div>
                        </motion.div>
                    ))}
                </AnimatePresence>
            </div>
        </div>
    );
}
